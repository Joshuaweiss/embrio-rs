language: rust
sudo: false
cache: cargo

rust:
- nightly
- nightly-2018-09-08

os:
- linux
- osx

install:
- rustup target add thumbv6m-none-eabi
- rustup target add thumbv7m-none-eabi

script:
- cargo test --all --exclude embrio-nrf51 --exclude pca10031
- cargo build --target thumbv6m-none-eabi -p embrio-executor -p embrio-nrf51
- cargo build --target thumbv6m-none-eabi -p pca10031 --examples
- cargo build --target thumbv7m-none-eabi -p embrio-executor

matrix:
  include:
  - name: rustfmt
    install:
    - rustup component add rustfmt-preview
    script:
    - cargo fmt --all -- --check

  - name: clippy
    install:
    - rustup component add clippy-preview
    - rustup target add thumbv6m-none-eabi
    script:
    - cargo clippy --all --exclude embrio-nrf51 --exclude pca10031 -- -Dwarnings
    - cargo clippy --target thumbv6m-none-eabi -p embrio-nrf51 -p pca10031 -- -Dwarnings

  - name: doc
    script:
    - cargo doc --all --all-features --no-deps
